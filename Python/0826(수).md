## 8/26(수)  

> 매개변수를 추가해 요청을 전송하는 방법

- 지역번호를 사용해 기상정보를 가져오는 프로그램

- 매개변수 stnid : 기상 정보를 알고 싶은 지역을 지정
- 서울/경기도의 정보를 다음과 같이 출력한다.

![image-20200826123956551](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826123956551.png)

![image-20200826124011351](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826124011351.png)



> 매개변수를 명령줄에서 지정하기

- 다른 지역의 정보를 알아내고 싶을 때 명령줄에서 곧바로 지역 번호를 입력하고 사용하는 방법

![image-20200826124308925](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826124308925.png)

![image-20200826124420290](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826124420290.png)



-------

#### BeautifulSoup로 스크레이핑

-------

> BeautifulSoup로 스크레이핑하기

- 스크레이핑이란 웹사이트에서 데이터를 추출하고, 원하는 정보를 추출하는 것이다.
- BeautifulSoup 라이브러리를 이용하면 간단하게 HTML, XML에서 정보를 추출할 수 있다.



> BeautifulSoup 설치

![image-20200826125156600](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826125156600.png)

![image-20200826125056778](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826125056778.png)



> BeautifulSoup  기본 사용법

- 웹 사이트로부터 HTML을 가져와서 사용하는 것이 아닌 HTML을 문자열로 만들어 사용하고 있다. 그리고 문자열 분석을 완료하면 결과를 출력한다.

![image-20200826125738243](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826125738243.png)

![image-20200826125751171](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826125751171.png)



> ID로 요소를 찾는 방법

![image-20200826125902161](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826125902161.png)

![image-20200826125917549](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826125917549.png)



> 여러 개의 요소 추출하기 - find_all() 메서드

- 여러 개의 태그를 한 번에 추출하고 싶을 때는 find_all() 메소드를 사용한다. 
- 다음 코드는 HTML 내부에 있는 여러 개의 < a> 태그를 추출하는 프로그램이다. < a> 태그는 하이퍼링크 태그이므로, 링크 대상은 href 속성으로 지정하고 링크를 설명하는 텍스트는 태그 내부에 입력한다.

![image-20200826135138457](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826135138457.png)

![image-20200826135147902](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826135147902.png)



> urlopen()과 BeautifulSoup 조합하기

- urlopen()을 사용해 "기상청 RSS"에서 특정 내용을 추출

![image-20200826135629818](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826135629818.png)

![image-20200826135700626](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826135700626.png)



> CSS 선택자 사용하기

- BeautifulSoup는 자바스크립트 라이브러리인 jQuery처럼 CSS 선택자를 지정해서 원하는 요소를 추출하는 기능도 제공

| 메서드                    | 설명                                             |
| ------------------------- | ------------------------------------------------ |
| soup.select_one(<선택자>) | CSS 선택자로 요소 하나를 추출합니다.             |
| soup.select(<선택자>)     | CSS 선택자로 요소 여러 개를 리스트로 추출합니다. |



- 다음은 HTML에서 < h1> 태그와 < li> 태그를 추출해 출력하는 코드이다.

![image-20200826140131385](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826140131385.png)

![image-20200826140149146](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826140149146.png)



> 네이버 금융에서 환율 정보 추출하기

- "네이버 금융"에서 원/달러 환율 정보를 추출

![image-20200826142603805](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826142603805.png)

![image-20200826142650734](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826142650734.png)

![image-20200826142702990](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826142702990.png)



---------

#### CSS 선택자

--------

> 위키 문헌에 공개돼 있는 윤동주 작가의 작품 목록 가져오기

- https://ko.wikisource.org/wiki/저자:윤동주
- 윤동주의 작품집과 작품 모두 가져오기 

![image-20200826144130666](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826144130666.png)

- CSS 선택자 복사(오른쪽 마우스 -> Copy -> Copy selector)
- 다음과 같은 CSS 선택자가 복사된다.

```
#mw-content-text > div.mw-parser-output > ul:nth-child(6) > li > b > a
```

- nth-child(6) : n번째 있는 요소를 의미한다. nth-child(6)은 6번째에 있는 태그라는 의미이다.
- #mw-content-text 내부에 있는 ul태그는 모두 작품과 관련된 태그이다. 따라서 따로 구분할 필요가 없으므로 생략해도 된다.(BeautifulSoup은 nth-child를 지원하지 않음)

![image-20200826145005403](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826145005403.png)

![image-20200826145059347](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826145059347.png)



> CSS 선택자 자세히 알아보기

- 선택자를 잘 사용하면 구조가 복잡한 HTML 페이지라도 한 번에 원하는 데이터를 추출할 수 있다. 



- 선택자 기본 서식

| 서식           | 설명                             |
| -------------- | -------------------------------- |
| *              | 모든 요소를 선택한다.            |
| < 요소 이름 >  | 요소 이름을 기반으로 선택한다.   |
| .<클래스 이름> | 클래스 이름을 기반으로 선택한다. |
| #<id 이름>     | id 속성을 기반으로 선택한다.     |



- 선택자들의 관계를 지정하는 서식

| 서식                  | 설명                                                         |
| --------------------- | ------------------------------------------------------------ |
| <선택자>, <선택자>    | 쉼표로 구분된 여러 개의 선택자를 모두 선택한다.              |
| <선택자> <선택자>     | 앞 선택자의 후손 중 뒤 선택자에 해당하는 것을 모두 선택한다. |
| <선택자> > <선택자>   | 앞 선택자의 자손 중 뒤 선택자에 해당하는 것을 모두 선택한다. |
| <선택자> + <선택자>   | 같은 계층에서 바로 뒤에 있는 요소를 선택한다.                |
| <선택자1> ~ <선택자2> | 선택자1부터 선택자2까지의 요소를 모두 선택한다.              |



- 선택자 속성을 기반으로 지정하는 서식

| 서식                  | 선택자                                                       |
| --------------------- | ------------------------------------------------------------ |
| <요소>[<속성>]        | 해당 속성을 가진 요소를 선택한다.                            |
| <요소>[<속성>=<값>]   | 해당 속성의 값이 지정한 값과 같은 요소를 선택한다.           |
| <요소>[<속성>~=<값>]  | 해당 속성의 값이 지정한 값을 단어로 포함(띄어쓰기로 구분해서 완전히 포함)하고 있다면 선택한다. |
| <요소>[<속성>\|=<값>] | 해당 속성의 값으로 시작하면 선택한다(이때 하이픈 기호로 구분해서 확인한다.) |
| <요소>[<속성>^=<값>]  | 해당 속성의 값이 지정한 값으로 시작하면 선택한다.            |
| <요소>[<속성>$=<깂>]  | 해당 속성의 값이 지정한 값으로 끝나면 선택한다.              |
| <요소>[<속성>*=<값>]  | 해당 속성의 값이 지정한 값을 포함하고 있다면 선택한다.       |



- 위치 또는 상태를 지정하는 서식

| 서식                     | 설명                           |
| ------------------------ | ------------------------------ |
| <요소>:root              | 루트 요소                      |
| <요소>:nth-child(n)      | n번째 자식 요소                |
| <요소>:nth-last-child(n) | 뒤에서부터 n번째 자식 요소     |
| <요소>:nth-of-type(n)    | n번째 해당 종류의 요소         |
| <요소>:first-child       | 마지막 번째 자식 요소          |
| <요소>:last-child        | 마지막 번째 자식 요소          |
| <요소>:first-of-type     | 첫 번째 해당 종류의 요소       |
| <요소>:last-of-type      | 마지막 번째 해당 종류의 요소   |
| <요소>:only-child        | 자식으로 유일한 요소           |
| <요소>:only-of-type      | 자식으로 유일한 종류의 요소    |
| <요소>:empty             | 내용이 없는 요소               |
| <요소>:lang(code)        | 특정 언어로 code를 지정한 요소 |
| <요소>:not(s)            | s 이외의 요소                  |
| <요소>:enabled           | 활성화된 UI 요소               |
| <요소>:disabled          | 비활성화된 UI 요소             |
| <요소>:checked           | 체크돼 있는 UI 요소를 선택     |



> CSS 선택자로 추출 연습하기

- books.html

![image-20200826150711800](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826150711800.png)

![image-20200826150744715](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826150744715.png)

![image-20200826150811854](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826150811854.png)



> CSS 선택자로 과일과 야채 선택해보기

- 아보카도 추출하기

![image-20200826150915952](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826150915952.png)

![image-20200826151930039](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826151930039.png)

![image-20200826151938888](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826151938888.png)



> 정규 표현식과 함께 조합하기

- CSS선택자라기 보다는 BeautifulSoup의 기능인데, 정규 표현식을 조합해서 요소를 추출할 수 있다. 예를들어, 링크를 나타내는 < a >태그 중에서 https 프로토콜로 통신하는 링크만 추출하고 싶다면 다음의 코드를 사용한다.

![image-20200826152108407](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826152108407.png)

![image-20200826152124504](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826152124504.png)



------------

#### 링크에 있는 것을 한꺼번에 내려받기

--------

> 상대 경로를 전개하는 방법

- < a > 태그의 href 속성에 링크 대상이 "../img/foo.png"처럼 상대 경로로 적혀 있다고 하면 대상에 있는 것을 다운 받으려면 상대 경로를 절대 경로로 변환해야 한다.
- 상대 경로를 전개할 땐 urllib.parse.urljoin() 을 사용한다.

![image-20200826152427461](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826152427461.png)

![image-20200826152442662](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826152442662.png)

- 결과를 보면 기본 URL을 기반으로 상대 경로를 절대 경로로 변환한다는 것을 알 수 있다.

- 만약 상대경로(path 매개변수)가 http://등으로 시작한다면 기본 URL(base 매개변수)을 무시하고, 두 번째 매개변수에 지정한 URL을 리턴한다. 예제 코드로 동작을 확인해보자

![image-20200826153020377](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826153020377.png)

![image-20200826153032813](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826153032813.png)



> 모든 페이지를 한꺼번에 다운받는 프로그램

- 프로그램을 실행하면 사이트 내부의 파일 또는 HTML 등을 모두 다운

![image-20200826160420122](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826160420122.png)

![image-20200826160438106](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826160438106.png)

![image-20200826161221282](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826161221282.png)



-----------

#### 로그인이 필요한 사이트에서 다운받기

-----

> requests 사용해보기

- urllib.request로도 쿠키를 이용한 접근이 가능하지만 이 방법은 복잡하다. 따라서 requests라는 패키지를 사용한다.
- request 설치

![image-20200826161717843](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826161717843.png)

![image-20200826161648630](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826161648630.png)



- 한빛출판네트워크 사이트에 로그인한 후 "마이페이지"에서 마일리지와 코인을 확인하는 예제를 실행

https://www.hanbit.co.kr/member/login.html

![image-20200826162215839](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826162215839.png)

- 아이디와 비밀번호를 입력하는 부분에 마우스 오른쪽 버튼을 클릭하고 [검사]를 누른다. 입력 양식(input태그)으로 m_id, m_passwd라는 값(name 속성의 값)을 입력하고, 입력 양식을 제출하면 로그인되는 구조라는 것을 알 수 있다.
- 로그인하고 마이페이지에 들어가면 다음과 같은 내용이 출력된다. 여기서 마일리지(.mileage_section1 > span)"와 "한빛이코인(.mileage_section2 > span)"을 출력해보자.



> 로그인 과정 분석

- 일단 크롬의 [검사] 화면을 띄우고 [Network]라는 탭을 띄운다. (어떠한 네트워크 통신이 오가는지 확인할 수 있다.)
- 왼쪽 위에 레코드 표시에 붉은 불이 들어오면 어떤 웹 페이지, 이미지, 스타일 시트, 자바스크립트 파일 등이 오가는지 보인다. 지금 필요한 것은 "웹 페이지" 이므로 필터에 "Doc"을 클린한다.
- 그리고 "Preserve log"라는 곳에 체크한다. 원래 [Network] 탭은 페이지가 이동할 때 기존 페이지와 관련된 내용을 지우고, 새로운 페이지의 내용만 띄운다. 그러나 "Preserve log"를 체크하면 내용을 지우지 않고 유지해준다.

![image-20200826163731947](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826163731947.png)

- 로그인하면 index.html -> login_pro.php -> login.html의 과정으로 뭔가가 지나갔다는 것을 확인할 수 있다. 로그인하는 기본적인 과정을 의미한다.

- 오가는 과정을 하나하나 눌러보면 자세한 내용이 표시된다. 이 가운데 Request Method가 POST이고, 이전의 입력 양식에서 확인한 값이 나온는 곳을 찾는다.

- login_proc.php에서 확인할 수 있고 Form Data에 m_id와 m_passwd가 나온다.

![image-20200826164302382](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826164302382.png)

- 한마디로 login_proc.php가 로그인과 관련된 기능을 처리하는 곳이라는 것을 알 수 있고, Request  URL을 보면 "http://www.hanbit.co.kr/member/login_proc.php"라고 적혀 있다. 이곳에 입력 양식 데이터를 POST로 전달하면 로그인 할 수 있다.



> 파이썬으로 로그인하기

- 이러한 과정을 진행하고, 화면의 내용을 출력하는 프로그램을 파이썬으로 작성하면 다음과 같다.

![image-20200826165845599](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826165845599.png)

![image-20200826165829851](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826165829851.png)



--------

#### 웹 브라우저를 이용한 스크레이핑

-------

> Selenium + 파이퍼폭스 실행 환경 준비

![image-20200826172206772](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826172206772.png)

- 파이어폭스 설치

![image-20200826172238582](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826172238582.png)

![image-20200826173019143](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826173019143.png)



- Selenium 설치

![image-20200826173101842](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826173101842.png)



- 폴더 생성

![image-20200826173549809](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826173549809.png)

=>나눠서 만들어야 하는 것을 -p옵션으로 한 번에 생성 가능하다는 것을 보여줌



- 파이어폭스 조작을 위한 드라이버 설치

https://github.com/mozilla/geckodriver/releases/tag/v0.27.0

![image-20200826174058000](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826174058000.png)

=> 링크주소 복사

![image-20200826174222281](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826174222281.png)

![image-20200826174308338](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826174308338.png)

![image-20200826174344521](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826174344521.png)



- 한글 폰트 설치

![image-20200826174552581](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826174552581.png)

- commit

![image-20200826175012195](C:\Users\whtpw\AppData\Roaming\Typora\typora-user-images\image-20200826175012195.png)